function addTicket(n,t){const u=$("#ticketsList");let i=t||$("#ticketsList li[data-index]").length,r;if(n){r=$(`
                <li class="list-group-item border rounded px-4 py-2 mb-3" data-index="${i}">
                    <div class="form-group mb-3">
                        <label for="Tickets[${i}].FirstName">First Name</label>
                        <input class="form-control" type="text" id="Tickets[${i}].FirstName" maxlength="100" name="Tickets[${i}].FirstName" value="${n.FirstName}">
                        <span class="text-danger field-validation-valid" data-valmsg-for="Tickets[${i}].FirstName" data-valmsg-replace="true"></span>
                    </div>
                    <div class="form-group mb-3">
                        <label for="Tickets[${i}].LastName">Last Name</label>
                        <input class="form-control" type="text" id="Tickets[${i}].LastName" maxlength="100" name="Tickets[${i}].LastName" value="${n.LastName}">
                        <span class="text-danger field-validation-valid" data-valmsg-for="Tickets[${i}].LastName" data-valmsg-replace="true"></span>
                    </div>
                    <div class="form-group mb-3">
                        <label for="Tickets[${i}].Email">Email Address</label>
                        <input class="form-control" type="email" id="Tickets[${i}].Email" name="Tickets[${i}].Email" value="${n.Email}">
                        <span class="field-validation-valid" data-valmsg-for="Tickets[${i}].Email" data-valmsg-replace="true"></span>
                    </div>
                    <div class="form-group mb-3">
                        <label for="Tickets[${i}].Age">Age</label>
                        <input class="form-control" type="number" data-val="true" data-val-range="Please insert a valid age." data-val-range-max="200" data-val-range-min="0" data-val-required="The Age field is required." id="Tickets[${i}].Age" name="Tickets[${i}].Age" value="${n.Age}"><input name="__Invariant" type="hidden" value="Tickets[${i}].Age">
                        <span class="text-danger field-validation-valid" data-valmsg-for="Tickets[${i}].Age" data-valmsg-replace="true"></span>
                    </div>
                    <div class="form-group mb-3">
                        <label for="Tickets[${i}].SeatNumber">Seat Number</label>
                        <button type="button" class="form-control text-start" data-bs-target="#seat-map-modal" ticket-index="${i}">${n.SeatNumber||"None"}</button>
                        <input type="hidden" id="Tickets[${i}].SeatNumber" name="Tickets[${i}].SeatNumber" value="${n.SeatNumber}">
                        <span class="text-danger field-validation-valid" data-valmsg-for="Tickets[${i}].SeatNumber" data-valmsg-replace="true"></span>
                    </div>
                   <button type="button" class="btn btn-danger btn-sm remove-ticket-btn" data-index="${i}">
                       <i class="bi bi-x"></i> Remove
                   </button>
                </li>
            `);let t=$(`#ticketsList li[data-index="${i}"]`);if(t.length){t.replaceWith(r);return}}else r=$(`
                <li class="list-group-item border rounded px-4 py-2 mb-3" data-index="${i}">
                    <div class="form-group mb-3">
                        <label for="Tickets[${i}].FirstName">First Name</label>
                        <input class="form-control" type="text" id="Tickets[${i}].FirstName" maxlength="100" name="Tickets[${i}].FirstName" value="">
                        <span class="text-danger field-validation-valid" data-valmsg-for="Tickets[${i}].FirstName" data-valmsg-replace="true"></span>
                    </div>
                    <div class="form-group mb-3">
                        <label for="Tickets[${i}].LastName">Last Name</label>
                        <input class="form-control" type="text" id="Tickets[${i}].LastName" maxlength="100" name="Tickets[${i}].LastName" value="">
                        <span class="text-danger field-validation-valid" data-valmsg-for="Tickets[${i}].LastName" data-valmsg-replace="true"></span>
                    </div>
                    <div class="form-group mb-3">
                        <label for="Tickets[${i}].Email">Email Address</label>
                        <input class="form-control" type="email" id="Tickets[${i}].Email" name="Tickets[${i}].Email" value="">
                        <span class="field-validation-valid" data-valmsg-for="Tickets[${i}].Email" data-valmsg-replace="true"></span>
                    </div>
                    <div class="form-group mb-3">
                        <label for="Tickets[${i}].Age">Age</label>
                        <input class="form-control" type="number" data-val="true" data-val-range="Please insert a valid age." data-val-range-max="200" data-val-range-min="0" data-val-required="The Age field is required." id="Tickets[${i}].Age" name="Tickets[${i}].Age" value="0"><input name="__Invariant" type="hidden" value="Tickets[${i}].Age">
                        <span class="text-danger field-validation-valid" data-valmsg-for="Tickets[${i}].Age" data-valmsg-replace="true"></span>
                    </div>
                    <div class="form-group mb-3">
                        <label for="Tickets[${i}].SeatNumber">Seat Number</label>
                        <button type="button" class="form-control text-start" data-bs-target="#seat-map-modal" ticket-index="${i}">None</button>
                        <input type="hidden" id="Tickets[${i}].SeatNumber" name="Tickets[${i}].SeatNumber" value="">
                        <span class="text-danger field-validation-valid" data-valmsg-for="Tickets[${i}].SeatNumber" data-valmsg-replace="true"></span>
                    </div>
                   <button type="button" class="btn btn-danger btn-sm remove-ticket-btn" data-index="${i}">
                       <i class="bi bi-x"></i> Remove
                   </button>
                </li>
            `);u.append(r)}function storageAvailable(n){let t;try{t=window[n];const i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(i){return i instanceof DOMException&&i.name==="QuotaExceededError"&&t&&t.length!==0}}function loadValues(n){$("#FirstName").val(n.FirstName);$("#LastName").val(n.LastName);$("#Email").val(n.Email);$("#BirthDate").val(n.BirthDate);$("#Address1").val(n.Address1);$("#Address2").val(n.Address2);$("#City").val(n.City);$("#Country").val(n.Country);n.Tickets.forEach(function(n,t){if(t===0){let i=$.escapeSelector("Tickets[0].");$(`#${i}FirstName`).val(n.FirstName);$(`#${i}LastName`).val(n.LastName);$(`#${i}Email`).val(n.Email);$(`#${i}Age`).val(n.Age);$(`#${i}SeatNumber`).val(n.SeatNumber);$(`button[data-bs-target="#seat-map-modal"][ticket-index="${t}"]`).text(n.SeatNumber||"None")}else addTicket(n,t)})}function updateValue(n,t){if(n.id.startsWith("Tickets[")){let i=$(n).closest("li").attr("data-index"),r=n.id.split(".")[1];t.Tickets[i][r]=$(n).val()}else t[n.id]=$(n).val();window.sessionStorage.setItem(KEY_SS_BOOKING_DATA,JSON.stringify(t))}function seatCode(n,t){return String.fromCharCode(65+n)+(t+1)}function getInputSeat(n){let t=$.escapeSelector(`Tickets[${n}].SeatNumber`);return $("#"+t).val()}function setInputSeat(n,t,i){let r=$.escapeSelector(`Tickets[${n}].SeatNumber`);$("#"+r).val(t).trigger("change");i[n]=t;$("#selected-seat-span").text(t||"None");$(`button[data-bs-target="#seat-map-modal"][ticket-index="${n}"]`).text(t||"None")}function renderSeats(n,t,i){$.get(`/flights/${n}/occupied-seats`,function(n){const o=i.seatRows,r=i.seatColumns,f=i.windowSeats,s=r-f;let u=$("#ticket-idx-modal").val();$('input[id$="SeatNumber"]').each(function(){let i=$(this),r=i.val();if(n.includes(r)){let n=i.closest("li").attr("data-index");setInputSeat(n,"",t)}});let e=$('<div id="seat-map"><\/div>');for(let i=0;i<o;i++){let h=$('<div class="seat-row"><\/div>'),o=$('<div class="seats-center"><\/div>'),c=$('<div class="seats-left"><\/div>'),l=$('<div class="seats-right"><\/div>');for(let e=0;e<r;e++){let v=seatCode(e,i),a=$('<div class="seat"><\/div>');a.attr("data-seat",v);t.includes(v)?(a.addClass("occupied"),u&&v===getInputSeat(u)&&a.addClass("selected")):n.includes(v)?a.addClass("unavailable"):a.addClass("available");r===1?o.append(a):e<f?c.append(a):e>=s?l.append(a):o.append(a);r>1?h.append(c).append(o).append(l):h.append(o)}e.append(h)}$("#seat-map").replaceWith(e);$("#seat-map .seat.available, #seat-map .seat.selected").off("click").on("click",function(){let n=$(this);if(n.hasClass("selected"))return n.removeClass("selected occupied").addClass("available"),setInputSeat(u,"",t),!0;$("#seat-map .seat.selected").removeClass("selected occupied").addClass("available");n.removeClass("available").addClass("occupied selected");let i=n.data("seat");setInputSeat(u,i,t)})})}function openModal(n,t,i,r){let u=$(n).attr("ticket-index");$("#ticket-idx-modal").val(u);let f=$.escapeSelector(`Tickets[${u}].SeatNumber`);$("#selected-seat-span").text($("#"+f).val()||"None");renderSeats(t,i,r);$("#seat-map-modal").modal("show")}const KEY_SS_BOOKING_DATA="bookingData";$(function(){var n,t;if(storageAvailable("sessionStorage")){let i=$("#Email").val(),t=$.escapeSelector("Tickets[0].");n={sessionUser:i||"__anonymous__",FirstName:$("#FirstName").val(),LastName:$("#LastName").val(),Email:i,BirthDate:$("#BirthDate").val(),Address1:$("#Address1").val(),Address2:$("#Address2").val(),City:$("#City").val(),Country:$("#Country").val(),Tickets:[{FirstName:$(`#${t}FirstName`).val(),LastName:$(`#${t}LastName`).val(),Email:$(`#${t}Email`).val(),Age:$(`#${t}Age`).val(),SeatNumber:$(`#${t}SeatNumber`).val()}]};let r=window.sessionStorage.getItem(KEY_SS_BOOKING_DATA);r&&(oldBookingData=JSON.parse(r),oldBookingData.sessionUser==n.sessionUser&&(n=oldBookingData,loadValues(n)));window.sessionStorage.setItem(KEY_SS_BOOKING_DATA,JSON.stringify(n))}let i=$("#FlightId").val();t=n.Tickets.map(n=>n.SeatNumber);$.get(`/flights/${i}/seat-config/`,function(n){$(document).on("click",'button[data-bs-target="#seat-map-modal"]',function(){openModal(this,i,t,n)})});$(document).on("click","#add-ticket-btn",function(){addTicket();n.Tickets.push({FirstName:"",LastName:"",Email:"",Age:0,SeatNumber:""})});$(document).on("change blur","input.form-control",function(){updateValue(this,n)});$(document).on("click",".remove-ticket-btn",function(){let i=$(this).closest("li"),r=i.attr("data-index");i.remove();$("#ticketsList li[data-index]").each(function(n){$(this).attr("data-index",n);$(this).find("div.form-group").each(function(){let t=$(this).find("label").attr("for").replace(/Tickets\[\d+]/,`Tickets[${n}]`);$(this).find("label").attr("for",t);$(this).find("input").each(function(){$(this).attr("name")=="__Invariant"?$(this).val(t):($(this).attr("id",t),$(this).attr("name",t))});$(this).find('button[data-bs-target="#seat-map-modal"]').attr("ticket-index",n);$(this).find("span").attr("data-valmsg-for",t)});$(this).find(".remove-ticket-btn").attr("data-index",n)});n.Tickets.splice(r,1);window.sessionStorage.setItem(KEY_SS_BOOKING_DATA,JSON.stringify(n));t.splice(r,1)});$("form").on("submit",function(){window.sessionStorage.removeItem(KEY_SS_BOOKING_DATA)})});