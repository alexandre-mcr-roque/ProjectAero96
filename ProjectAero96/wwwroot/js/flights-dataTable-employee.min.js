$(function(){function u(n){return"<dl>"+`<dd>Departure Date: ${new Date(n.departureDate).toLocaleString()}</dd>`+`<dd>Flight Duration: ${n.flightDuration}</dd>`+(n.childPricePercentage<100?`<dd>${100-n.childPricePercentage}% Off for Children under 12 y.o.</dd>`:"")+(n.babyPricePercentage<100?`<dd>${100-n.babyPricePercentage}% Off for Children under 2 y.o.</dd>`:"")+`<dd><a href="/flights/book/${n.id}" role="button" class="btn btn-primary btn-sm">Book flight</a> <button id="unschedule-modal-toggle" unschedule-target="${n.id}" type="button" class="btn btn-danger btn-sm">Unschedule flight</a></dd>`+"<\/dl>"}function r(){let r=Number(t.value),u=Number(i.value);(r>0||u>0)&&r!=u?n.ajax.url(`/flights/getall?from=${r}&to=${u}`):n.ajax.url("/flights/getall");n.ajax.reload()}let t=$("#select-from-city")[0].ej2_instances[0],i=$("#select-to-city")[0].ej2_instances[0],n=$("#table-flights").DataTable({layout:{topStart:null,topEnd:null,bottomEnd:["paging","pageLength"]},ajax:{url:"/flights/getall",dataSrc:"flights"},processing:!0,columnDefs:[{className:"align-middle",targets:"_all"}],columns:[{data:"departureCity.name"},{data:"arrivalCity.name"},{data:n=>n.departureDate.split("T",1)[0].replace(/-/g,"/"),className:"dt-left"},{data:"price",type:"num-fmt",className:"dt-left"},{className:"dt-control",orderable:!1,data:null,defaultContent:""}]});n.processing(!1);n.on("click","td.dt-control",function(t){let r=t.target.closest("tr"),i=n.row(r);i.child.isShown()?i.child.hide():i.child(u(i.data())).show()});t.value="";t.text="";t.index="";t.change=r;i.value="";i.text="";i.index="";i.change=r;$("#table-flights").on("click",'button[id="unschedule-modal-toggle"]',function(){let n=$(this).attr("unschedule-target");$("#unschedule-flightid").val(n);$("#unschedule-modal").modal("show")});$("#confirm-unschedule").on("click",function(){let t=$("#unschedule-flightid").val(),i=$('input[name="__RequestVerificationToken"]').val();$.ajax({url:`/flights/unschedule/${t}`,type:"POST",headers:{RequestVerificationToken:i},success:function(){n.ajax.reload()},error:function(n){alert(`Error unscheduling flight: ${n.responseText}`)},complete:function(){$("#unschedule-modal").modal("hide")}})})});